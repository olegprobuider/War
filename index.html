<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>–°—Ç—Ä–∞—Ç–µ–≥–∏—è ‚Äî –∑–∞—Ö–≤–∞—Ç —Å—Ç—Ä–∞–Ω</title>
<style>
  body {
    margin:0; padding:0; font-family: Arial, sans-serif;
    background: #e1f0ff;
    user-select:none;
    display:flex; flex-direction: column; align-items:center;
  }
  #screenChoose, #screenGame {
    width: 100%; max-width: 600px; padding: 10px; box-sizing: border-box;
  }
  #screenChoose {
    margin-top: 40px;
    text-align: center;
  }
  #screenChoose h2 {
    margin-bottom: 20px;
  }
  .flag-select {
    font-size: 40px; cursor:pointer; margin: 8px;
    display: inline-block; user-select:none;
    transition: transform 0.2s;
  }
  .flag-select:hover {
    transform: scale(1.3);
  }
  #btnStart {
    margin-top: 30px;
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    background: #3a86ff;
    color: white;
    border: none;
    border-radius: 8px;
    user-select:none;
  }

  #headerGame {
    display:flex; justify-content: space-between; align-items:center;
    background:#3a86ff; color:#fff; padding:10px 20px; border-radius: 8px 8px 0 0;
  }
  #headerGame div {
    font-size: 18px;
    font-weight: 700;
  }

  #map {
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 2px;
    margin-top: 10px;
    user-select:none;
  }
  .map-cell {
    width: 38px; height: 38px;
    font-size: 28px;
    line-height: 38px;
    text-align: center;
    cursor: pointer;
    border-radius: 6px;
    background: #a0d8ff;
    transition: background-color 0.3s;
    user-select:none;
  }
  .map-cell.neutral {
    background: #c8c8c8;
    cursor: default;
  }
  .map-cell.owned {
    background: #7bd47b;
  }
  .map-cell.enemy {
    background: #e27a7a;
  }
  .map-cell:hover {
    filter: brightness(1.15);
  }

  #infoPanel {
    margin-top: 15px;
    background: white;
    padding: 12px;
    border-radius: 8px;
    box-shadow: 0 0 8px rgba(0,0,0,0.15);
  }

  #stats, #upgradePanel, #attackPanel, #logPanel {
    margin-top: 15px;
  }

  #stats div, #upgradePanel div, #attackPanel div {
    margin-bottom: 8px;
  }

  button {
    cursor: pointer;
    padding: 6px 12px;
    font-size: 16px;
    border-radius: 6px;
    border: none;
    background: #3a86ff;
    color: white;
    transition: background-color 0.3s;
    user-select:none;
  }
  button:disabled {
    background: #999;
    cursor: not-allowed;
  }
  button:hover:not(:disabled) {
    background: #265bb5;
  }

  #logPanel {
    max-height: 120px;
    overflow-y: auto;
    background: #eef6ff;
    padding: 8px;
    border-radius: 8px;
    font-size: 14px;
    user-select:none;
  }

  .emoji {
    margin-right: 6px;
    font-size: 20px;
  }
</style>
</head>
<body>

<!-- –í—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã -->
<div id="screenChoose">
  <h2>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –¥–ª—è –Ω–∞—á–∞–ª–∞</h2>
  <div id="flagsContainer">
    <!-- –§–ª–∞–≥–∏ –±—É–¥—É—Ç —Å–æ–∑–¥–∞–Ω—ã JS -->
  </div>
  <button id="btnStart" disabled>–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
</div>

<!-- –ò–≥—Ä–æ–≤–æ–π —ç–∫—Ä–∞–Ω -->
<div id="screenGame" style="display:none;">
  <div id="headerGame">
    <div>–ë–∞–ª–∞–Ω—Å: <span id="balance">1000</span> üí∞</div>
    <div>–í–∞—à–∞ —Å—Ç—Ä–∞–Ω–∞: <span id="playerCountryFlag"></span> <span id="playerCountryName"></span></div>
  </div>

  <div id="map" title="–ö–∞—Ä—Ç–∞ –º–∏—Ä–∞ ‚Äî –∫–ª–∏–∫–Ω–∏—Ç–µ –ø–æ —Å—Ç—Ä–∞–Ω–µ"></div>

  <div id="infoPanel">
    <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç—Ä–∞–Ω–µ <span id="infoFlag"></span> <span id="infoName"></span></h3>
    <div id="stats">
      <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—Ä–∞–Ω—ã –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
    </div>

    <div id="upgradePanel">
      <h4>–ü—Ä–æ–∫–∞—á–∞—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ –∞—Ä–º–∏—é</h4>
      <div><button data-upgrade="economy">üè≠ –≠–∫–æ–Ω–æ–º–∏–∫–∞ (+10% –¥–æ—Ö–æ–¥) ‚Äî 200 üí∞</button></div>
      <div><button data-upgrade="army">üíÇ –ê—Ä–º–∏—è (+10% —Å–∏–ª—ã) ‚Äî 200 üí∞</button></div>
      <div><button data-upgrade="navy">üõ≥Ô∏è –§–ª–æ—Ç (+10% —Å–∏–ª—ã) ‚Äî 200 üí∞</button></div>
      <div><button data-upgrade="airforce">‚úàÔ∏è –ê–≤–∏–∞—Ü–∏—è (+10% —Å–∏–ª—ã) ‚Äî 200 üí∞</button></div>
      <div><button data-upgrade="railway">üöÇ –ñ–µ–ª–µ–∑–Ω–∞—è –¥–æ—Ä–æ–≥–∞ (+10% –¥–æ—Ö–æ–¥) ‚Äî 200 üí∞</button></div>
      <div><button data-upgrade="police">üëÆ –ü–æ–ª–∏—Ü–∏—è (—É–º–µ–Ω—å—à–∞–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–∏—è) ‚Äî 200 üí∞</button></div>
    </div>

    <div id="attackPanel" style="margin-top: 20px;">
      <h4>–ù–∞–ø–∞—Å—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω—É</h4>
      <button id="btnAttack" disabled>–ù–∞–ø–∞—Å—Ç—å</button>
    </div>

    <div id="logPanel">
      <h4>–õ–æ–≥ —Å–æ–±—ã—Ç–∏–π</h4>
      <div id="logMessages"></div>
    </div>
  </div>
</div>

<script>
(() => {
  // --- –î–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω ---
  // –°—Ç—Ä–∞–Ω—ã: id, –∏–º—è, —Ñ–ª–∞–≥, –Ω–∞—á–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏–∫–∞, –∞—Ä–º–∏—è, –ø–æ–ª–∏—Ü–∏—è –∏ —Ç.–ø.
  const countries = [
    {id:'CN', name:'–ö–∏—Ç–∞–π', flag:'üá®üá≥'},
    {id:'FR', name:'–§—Ä–∞–Ω—Ü–∏—è', flag:'üá´üá∑'},
    {id:'GB', name:'–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è', flag:'üá¨üáß'},
    {id:'PL', name:'–ü–æ–ª—å—à–∞', flag:'üáµüá±'},
    {id:'UM', name:'–û—Å—Ç—Ä–æ–≤–∞ –°–®–ê', flag:'üá∫üá≤'},
    {id:'UA', name:'–£–∫—Ä–∞–∏–Ω–∞', flag:'üá∫üá¶'},
    {id:'AE', name:'–û–ê–≠', flag:'üá¶üá™'},
    {id:'IE', name:'–ò—Ä–ª–∞–Ω–¥–∏—è', flag:'üáÆüá™'},
    {id:'IT', name:'–ò—Ç–∞–ª–∏—è', flag:'üáÆüáπ'},
    {id:'KZ', name:'–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω', flag:'üá∞üáø'},
    {id:'RU', name:'–†–æ—Å—Å–∏—è', flag:'üá∑üá∫'},
  ];

  // –ö–∞—Ä—Ç–∞ –º–∏—Ä–∞ - 12x6 —è—á–µ–µ–∫, –¥–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã —É–∫–∞–∂–µ–º, —á—Ç–æ –∫–∞–∂–¥–∞—è –∫–ª–µ—Ç–∫–∞ –ª–∏–±–æ –ø—É—Å—Ç–∞—è (null),
  // –ª–∏–±–æ —Å–æ–¥–µ—Ä–∂–∏—Ç id —Å—Ç—Ä–∞–Ω—ã
  const mapGrid = [
    [null, 'RU',  null, 'CN',  null, 'KZ',  null,  null,  'PL', null,  'GB', null],
    ['RU',  'RU', 'RU',  'CN',  'CN', 'KZ',  null,  null,  'PL', 'PL', 'GB', null],
    [null, 'RU',  null, 'CN',  null, null,  null,  null,  null, 'PL', 'GB', 'FR'],
    [null, null,  null, null,  null, null,  null,  null,  null, null, 'IE', 'FR'],
    [null, 'UM',  null, null,  'AE', null,  null,  'IE', 'IE', 'IT', 'IT', null],
    [null, 'UM',  null, null,  'AE', null,  null,  null, 'IE', 'IT',  null, null],
  ];

  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—Å–µ —Å—Ç—Ä–∞–Ω—ã –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ (owner = null)
  // —É –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω—ã –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ
  const state = {};
  countries.forEach(c => {
    state[c.id] = {
      owner: null,            // id –∏–≥—Ä–æ–∫–∞ (–±—É–¥–µ—Ç 'player') –∏–ª–∏ null –∏–ª–∏ 'AI'
      economyLevel: 1,        // —É—Ä–æ–≤–µ–Ω—å —ç–∫–æ–Ω–æ–º–∏–∫–∏ (–¥–æ—Ö–æ–¥—ã)
      armyLevel: 1,           // –∞—Ä–º–∏—è
      navyLevel: 1,           // —Ñ–ª–æ—Ç
      airforceLevel: 1,       // –∞–≤–∏–∞—Ü–∏—è
      railwayLevel: 1,        // –∂/–¥
      policeLevel: 1,         // –ø–æ–ª–∏—Ü–∏—è
      baseIncome: 100,        // –±–∞–∑–æ–≤—ã–π –¥–æ—Ö–æ–¥ (–º–æ–∂–Ω–æ –ø–æ—Ç–æ–º –≤–∞—Ä—å–∏—Ä–æ–≤–∞—Ç—å)
      currentIncome: 100,     // –¥–æ—Ö–æ–¥ —Å —É—á—ë—Ç–æ–º –ø—Ä–æ–∫–∞—á–∫–∏
      isCaptured: false,      // –∑–∞—Ö–≤–∞—á–µ–Ω–∞ –ª–∏ –∏–≥—Ä–æ–∫–æ–º
    };
  });

  // –ò–≥—Ä–æ–∫
  let playerCountryId = null;
  let balance = 1000;

  // –í—ã–±—Ä–∞–Ω–Ω–∞—è —Å—Ç—Ä–∞–Ω–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞/—É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (id)
  let selectedCountryId = null;

  // –≠–ª–µ–º–µ–Ω—Ç—ã
  const screenChoose = document.getElementById('screenChoose');
  const flagsContainer = document.getElementById('flagsContainer');
  const btnStart = document.getElementById('btnStart');

  const screenGame = document.getElementById('screenGame');
  const playerCountryFlag = document.getElementById('playerCountryFlag');
  const playerCountryName = document.getElementById('playerCountryName');
  const balanceElem = document.getElementById('balance');
  const mapElem = document.getElementById('map');
  const infoFlag = document.getElementById('infoFlag');
  const infoName = document.getElementById('infoName');
  const statsElem = document.getElementById('stats');
  const upgradePanel = document.getElementById('upgradePanel');
  const attackPanel = document.getElementById('attackPanel');
  const btnAttack = document.getElementById('btnAttack');
  const logMessages = document.getElementById('logMessages');

  // –ó–∞–ø–æ–ª–Ω—è–µ–º –≤—ã–±–æ—Ä —Å—Ç—Ä–∞–Ω—ã —Ñ–ª–∞–≥–∞–º–∏
  countries.forEach(c => {
    const span = document.createElement('span');
    span.className = 'flag-select';
    span.textContent = c.flag;
    span.title = c.name;
    span.dataset.id = c.id;
    flagsContainer.appendChild(span);
  });

  // –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–æ–º —Å—Ç—Ä–∞–Ω—ã
  flagsContainer.addEventListener('click', e => {
    if(e.target.classList.contains('flag-select')) {
      // –°–Ω—è—Ç—å –≤—ã–¥–µ–ª–µ–Ω–∏–µ —É –≤—Å–µ—Ö
      flagsContainer.querySelectorAll('.flag-select').forEach(el => el.style.border = '');
      // –û—Ç–º–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é
      e.target.style.border = '3px solid #3a86ff';
      playerCountryId = e.target.dataset.id;
      btnStart.disabled = false;
    }
  });

  btnStart.addEventListener('click', () => {
    if(!playerCountryId) return;
    // –ü—Ä–∏—Å–≤–∞–∏–≤–∞–µ–º –∏–≥—Ä–æ–∫—É –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω—É
    state[playerCountryId].owner = 'player';
    state[playerCountryId].isCaptured = true;
    selectedCountryId = playerCountryId;

    // –°–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –∏–≥—Ä—É
    screenChoose.style.display = 'none';
    screenGame.style.display = 'block';

    updateUI();
    logAdd(`–í—ã –Ω–∞—á–∞–ª–∏ –∏–≥—Ä—É –∑–∞ —Å—Ç—Ä–∞–Ω—É ${getCountryById(playerCountryId).name}`);
  });

  // --- –§—É–Ω–∫—Ü–∏–∏ ---

  function getCountryById(id) {
    return countries.find(c => c.id === id);
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ–π UI
  function updateUI() {
    balanceElem.textContent = balance;

    playerCountryFlag.textContent = getCountryById(playerCountryId)?.flag || '';
    playerCountryName.textContent = getCountryById(playerCountryId)?.name || '';

    renderMap();
    renderSelectedCountry();
    updateAttackButton();
  }

  // –†–µ–Ω–¥–µ—Ä –∫–∞—Ä—Ç—ã –º–∏—Ä–∞
  function renderMap() {
    mapElem.innerHTML = '';
    for(let r=0; r<mapGrid.length; r++) {
      for(let c=0; c<mapGrid[r].length; c++) {
        const cellCountryId = mapGrid[r][c];
        const cell = document.createElement('div');
        cell.className = 'map-cell';
        if(cellCountryId === null) {
          cell.classList.add('neutral');
          cell.textContent = 'üü¶';
          cell.title = '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏—è';
          cell.dataset.id = '';
          cell.style.cursor = 'default';
        } else {
          const country = getCountryById(cellCountryId);
          const st = state[cellCountryId];
          cell.textContent = country.flag;
          cell.title = country.name + (st.owner === 'player' ? ' (–í–∞—à–∞ —Å—Ç—Ä–∞–Ω–∞)' : st.owner === 'AI' ? ' (–í—Ä–∞–≥)' : ' (–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è)');
          cell.dataset.id = cellCountryId;

          if(st.owner === 'player') cell.classList.add('owned');
          else if(st.owner === 'AI') cell.classList.add('enemy');
        }
        cell.addEventListener('click', () => {
          if(cell.dataset.id) {
            selectedCountryId = cell.dataset.id;
            renderSelectedCountry();
            updateAttackButton();
          }
        });
        mapElem.appendChild(cell);
      }
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω—ã
  function renderSelectedCountry() {
    if(!selectedCountryId) {
      infoFlag.textContent = '';
      infoName.textContent = '';
      statsElem.innerHTML = '–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—É –Ω–∞ –∫–∞—Ä—Ç–µ';
      upgradePanel.style.display = 'none';
      attackPanel.style.display = 'none';
      return;
    }
    const c = getCountryById(selectedCountryId);
    const st = state[selectedCountryId];
    infoFlag.textContent = c.flag;
    infoName.textContent = c.name;

    let ownerStr = st.owner === 'player' ? '–í—ã' : st.owner === 'AI' ? '–í—Ä–∞–≥' : '–ù–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è';
    let capturedStr = st.isCaptured ? '–ó–∞—Ö–≤–∞—á–µ–Ω–∞' : '–°–≤–æ–±–æ–¥–Ω–∞';

    statsElem.innerHTML = `
      <div>–í–ª–∞–¥–µ–ª–µ—Ü: <b>${ownerStr}</b></div>
      <div>–°–æ—Å—Ç–æ—è–Ω–∏–µ: <b>${capturedStr}</b></div>
      <div>–≠–∫–æ–Ω–æ–º–∏–∫–∞: ${st.economyLevel} (–¥–æ—Ö–æ–¥: ${calculateIncome(selectedCountryId)})</div>
      <div>–ê—Ä–º–∏—è: ${st.armyLevel}</div>
      <div>–§–ª–æ—Ç: ${st.navyLevel}</div>
      <div>–ê–≤–∏–∞—Ü–∏—è: ${st.airforceLevel}</div>
      <div>–ñ–µ–ª–µ–∑–Ω–∞—è –¥–æ—Ä–æ–≥–∞: ${st.railwayLevel}</div>
      <div>–ü–æ–ª–∏—Ü–∏—è: ${st.policeLevel}</div>
    `;

    // –ê–ø–≥—Ä–µ–π–¥—ã –¥–æ—Å—Ç—É–ø–Ω—ã —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–≤–æ–µ–π —Å—Ç—Ä–∞–Ω—ã –∏ –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã—Ö
    if(st.owner === 'player') {
      upgradePanel.style.display = 'block';
      attackPanel.style.display = 'block';
      // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –∞–ø–≥—Ä–µ–π–¥–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –±–∞–ª–∞–Ω—Å–∞
      Array.from(upgradePanel.querySelectorAll('button')).forEach(btn => {
        btn.disabled = balance < 200;
      });
    } else {
      upgradePanel.style.display = 'none';
      attackPanel.style.display = 'none';
    }
  }

  // –†–∞—Å—á—ë—Ç –¥–æ—Ö–æ–¥–∞ —Å —Å—Ç—Ä–∞–Ω—ã —Å —É—á—ë—Ç–æ–º —É—Ä–æ–≤–Ω–µ–π —ç–∫–æ–Ω–æ–º–∏–∫–∏ –∏ –∂/–¥
  function calculateIncome(countryId) {
    const st = state[countryId];
    // –ë–∞–∑–æ–≤—ã–π –¥–æ—Ö–æ–¥ + (—ç–∫–æ–Ω–æ–º–∏–∫–∞ + –∂/–¥)*10%
    return Math.floor(st.baseIncome * (1 + 0.1 * (st.economyLevel - 1)) * (1 + 0.1 * (st.railwayLevel -1)));
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –Ω–∞–ø–∞–¥–µ–Ω–∏—è (–∞–∫—Ç–∏–≤–Ω–∞ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–∞ –≤—Ä–∞–∂–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∞ —Ä—è–¥–æ–º)
  function updateAttackButton() {
    if(!selectedCountryId || selectedCountryId === playerCountryId) {
      btnAttack.disabled = true;
      return;
    }
    const st = state[selectedCountryId];
    if(st.owner === 'player' || st.owner === 'AI') {
      // –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ—Å–µ–¥—Å—Ç–≤–æ –ø–æ –∫–∞—Ä—Ç–µ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ)
      const neighbors = getNeighbors(selectedCountryId);
      const isNeighbor = neighbors.includes(playerCountryId);
      btnAttack.disabled = !isNeighbor || st.owner === 'player';
    } else {
      btnAttack.disabled = false; // –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–µ –º–æ–∂–Ω–æ –∞—Ç–∞–∫–æ–≤–∞—Ç—å –±–µ–∑ —Å–æ—Å–µ–¥—Å—Ç–≤–∞
    }
  }

  // –ü–æ–ª—É—á–∏—Ç—å —Å–æ—Å–µ–¥–µ–π –ø–æ –∫–∞—Ä—Ç–µ (id —Å—Ç—Ä–∞–Ω)
  function getNeighbors(countryId) {
    let result = [];
    for(let r=0; r<mapGrid.length; r++) {
      for(let c=0; c<mapGrid[r].length; c++) {
        if(mapGrid[r][c] === countryId) {
          // –ü—Ä–æ–≤–µ—Ä–∏–º —Å–æ—Å–µ–¥–µ–π –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ –∏ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏
          [[r-1,c],[r+1,c],[r,c-1],[r,c+1]].forEach(([rr,cc]) => {
            if(rr >=0 && rr < mapGrid.length && cc >= 0 && cc < mapGrid[0].length) {
              const neighId = mapGrid[rr][cc];
